#!/usr/bin/env bash


# This script adds a new description to the README.md
# file in the current directory


HEADER_STYLE="####"
HEADER=""
BODY=""
ADD_NEWLINE_AFTER_HEADER=0

usage(){

    echo "Add a new description to your README.md

    Usage: describe [-h HEADER] [-b BODY] [-p HEADER-PREFIX]

    MAIN OPTIONS
    ============

    -h:
        header text in the description
    -s:
        header style [default is heading-5 ($HEADER_STYLE)]
    -b:
        description body(can use markdown styles)
    -n:
        insert a newline right after the body (requires no argument)
    " | less
}

quit(){
    # Exit with error
    usage && exit 1
}

if [[ $# -eq 0 ]]; then
    quit
fi

while getopts ":h:b:s:n" options; do
    case "${options}" in 
    h )
        HEADER="$OPTARG"
        ;;
    b )
        BODY="$OPTARG"
        ;;
    s )
        if [ -n "$OPTARG" ]; then
            HEADER_STYLE="$OPTARG"
        fi
        ;;
    n )
        ADD_NEWLINE_AFTER_HEADER=1
        ;;
    \? )
        echo "Invalid option: $OPTARG" 1>&2
        quit
        ;;
    : )
        if [[ "$OPTARG" -ne "n" ]]; then
            echo "$OPTARG requires an argument" 1>&2
            quit
        fi
        ;;
    esac
done

shift $(expr $OPTIND - 1)

if [ -n "$HEADER_STYLE" ]; then
    if [ $ADD_NEWLINE_AFTER_HEADER = 0 ]; then
        echo "$HEADER_STYLE $HEADER $BODY" >> README.md
    else
        echo "$HEADER_STYLE $HEADER
$BODY" >> README.md
    fi
else
    if [ $ADD_NEWLINE_AFTER_HEADER = 0 ]; then
        echo "$HEADER $BODY" >> README.md
    else
        echo "$HEADER
$BODY" >> README.md
    fi
fi